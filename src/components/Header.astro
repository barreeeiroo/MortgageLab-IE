---
import { Image } from "astro:assets";
import { SITE } from "@/lib/constants/site";
import { getPath } from "../lib/utils/path";
import { DesktopNav } from "./DesktopNav";
import { MobileNav } from "./MobileNav";
import { ThemeToggle } from "./ThemeToggle";
import logoLight from "../assets/logos/mortgagelab-logo-horizontal-light.min.svg";
import logoDark from "../assets/logos/mortgagelab-logo-horizontal-dark.min.svg";

const currentPath = Astro.url.pathname;

function isActive(href: string): boolean {
	const base = import.meta.env.BASE_URL.replace(/\/$/, "");
	const normalizedPath = currentPath.replace(/\/$/, "");
	const fullHref = `${base}${href}`.replace(/\/$/, "");
	return normalizedPath === fullHref || normalizedPath.startsWith(`${fullHref}/`);
}
---

<header class="sticky top-0 z-50 border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
	<div class="container mx-auto px-4">
		<nav class="flex h-14 items-center justify-between">
			<div class="flex items-center gap-2 md:gap-8">
				<MobileNav client:load logoLight={logoLight.src} logoDark={logoDark.src} currentPath={currentPath} />
				<a href={getPath("/")} class="shrink-0 hover:opacity-80 transition-opacity">
					<Image
						src={logoLight}
						alt={SITE.shortName}
						class="h-8 w-auto min-w-max dark:hidden"
					/>
					<Image
						src={logoDark}
						alt={SITE.shortName}
						class="h-8 w-auto min-w-max hidden dark:block"
					/>
				</a>
				<DesktopNav client:load currentPath={currentPath} />
			</div>
			<div class="flex items-center gap-4">
				<a
					href={getPath("/glossary")}
					class:list={[
						"hidden md:block text-sm transition-colors",
						isActive("/glossary")
							? "text-foreground font-medium"
							: "text-muted-foreground hover:text-foreground"
					]}
				>
					Glossary
				</a>
				<a
					href={getPath("/resources")}
					class:list={[
						"hidden md:block text-sm transition-colors",
						isActive("/resources")
							? "text-foreground font-medium"
							: "text-muted-foreground hover:text-foreground"
					]}
				>
					Resources
				</a>
				<ThemeToggle client:load />
			</div>
		</nav>
	</div>
</header>
